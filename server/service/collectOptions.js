const { tickerOptional } = require('./stocksService');

const axios = require('axios').default;
const s3Service = require('./s3Service');

async function collect_options() {
    const stocks = await s3Service.stocksSelect(process.env.select_bucket).getOptionalStocks(["Ticker", "Market Cap Val"]).then(v => JSON.parse(v)).then(v => v.sort((a, b) => b["Market Cap Val"] - a["Market Cap Val"]))
    stocks.map(v => v.Ticker).map(ticker => 
        get_options(ticker).then(v => {
            map_option(ticker, v) // TODO mapping
        }))
}

function get_options(ticker) {
    const url = `https://www.optionsprofitcalculator.com/ajax/getOptions?stock=${ticker.toLowerCase()}&reqId=1`;
    return axios.get(url)
        .then(function (response) {
            return response.data
        })
}

function map_option(ticker, obj){
    let result = {}
    for (const [key, value] of Object.entries(obj.options)) {
        console.log(`${key}: ${value}`);
      }
      return result
}

//collect_options()
getProxies()

function getProxies(){
    const proxiesStr = `46.175.70.69:44239
189.195.162.242:8080
190.7.141.66:47576
199.191.56.218:3128
54.38.155.94:6582
51.81.82.175:80
13.251.26.136:3128
54.38.155.88:6582
195.230.115.115:8080
118.174.220.14:43473
118.172.181.147:34388
185.97.118.215:8080
18.138.254.5:8080
54.38.218.210:6582
180.232.77.107:48779
72.249.76.221:3128
81.95.226.138:3128
54.228.137.107:80
213.174.1.150:31612
102.67.19.132:8080
58.84.164.115:53281
88.99.10.248:1080
187.62.191.3:61456
54.38.155.95:6582
165.22.64.68:36918
105.27.237.25:80
167.71.5.83:3128
144.76.214.153:1080
105.27.238.161:80
45.76.68.14:3128
103.250.166.16:48340
50.4.60.98:80
3.92.176.124:80
18.223.1.180:80
46.10.199.90:54567
14.139.62.246:80
212.227.164.87:80
222.112.240.147:80
58.120.171.37:8080
177.128.124.100:30368
162.144.106.161:3838
161.35.70.249:8080
128.199.214.87:3128
124.156.98.172:80
119.81.189.194:80
213.230.107.125:3128
212.87.220.2:3128
35.200.185.189:80
54.38.155.92:30303
45.62.248.109:80
195.154.47.113:3838
51.79.149.156:8888
216.162.88.226:8080
142.44.221.126:8080
59.120.117.244:80
2.186.126.114:8080
130.239.119.148:80
95.174.67.50:18080
83.97.23.90:18080
105.27.237.28:80
217.195.203.27:3128
105.27.238.166:80
88.99.10.249:1080
105.27.237.29:80
161.202.226.194:80
78.47.16.54:80
105.27.238.164:80
169.57.157.148:8123
105.27.238.165:80
209.97.150.167:8080
105.27.238.162:80
159.203.61.169:3128
173.192.128.238:25
176.9.119.170:8080
80.48.119.28:8080
159.8.114.37:8123
103.3.225.114:51332
1.10.188.52:32163
203.184.132.229:80
88.99.149.188:31288
103.115.14.142:80
202.169.255.5:8181
177.67.81.76:80
164.100.130.128:8080
54.168.222.142:80
173.212.202.65:80
193.106.94.106:8080
202.138.236.222:8080
125.162.157.52:8080
62.171.177.113:8888
217.165.93.198:53281
198.50.163.192:3129
14.139.219.231:8080
221.240.77.103:8080
217.61.123.133:3128
195.218.173.242:59964
105.27.237.24:80
160.202.145.206:80
105.27.238.160:80
105.27.238.163:80
105.27.238.167:80
37.120.192.154:8080
54.214.52.181:80
188.68.56.248:3128
198.98.55.168:8080
159.203.116.82:3128
46.8.33.198:8282
178.150.148.38:8282
45.162.49.82:58410
116.0.54.30:8080
35.212.118.112:3128
188.242.27.193:8080
103.111.14.222:8080
201.20.106.186:8080
103.144.75.122:8080
46.52.185.174:8080
200.150.70.66:8080
37.205.48.116:8080
185.219.57.50:8080
107.175.150.79:8080
179.191.118.42:20183
103.22.248.59:61661
180.183.29.238:3128
61.75.77.160:80
213.230.127.139:3128
195.154.242.205:3838
35.229.80.14:8080
185.189.211.70:8080
176.9.75.42:8080
128.199.202.122:8080
134.209.29.120:3128
191.96.42.80:8080
171.244.19.212:8080
102.129.249.120:8080
102.130.128.13:3128
5.190.141.106:8080
209.190.32.28:3128
103.86.187.242:23500
77.226.150.5:3128
46.150.76.25:37354
161.35.46.103:80
192.199.53.131:51650
102.130.133.102:53281
1.179.148.9:55636
98.190.250.150:48678
178.115.253.35:8080
91.228.89.29:3128
103.101.17.170:8080
187.188.194.212:3128
13.212.57.119:3128
122.154.72.102:8080
200.137.197.254:80
104.225.220.233:80
103.78.73.90:3128
186.194.120.72:8080
185.33.37.188:3128
195.138.83.218:53281
139.59.1.14:3128
181.198.97.241:30072
91.198.137.34:8888
104.40.158.173:80
105.27.237.26:80
165.22.81.30:39686
203.202.245.58:80
198.199.86.11:8080
105.27.237.30:80
157.230.103.189:34067
5.202.188.154:3128
178.124.210.88:8080
54.169.201.152:8888
13.235.234.254:80
88.99.10.255:1080
195.154.56.105:3838
105.27.237.31:80
144.76.214.154:1080
88.99.10.250:1080
103.241.227.107:6666
13.212.115.247:8080
207.144.111.230:8080
185.37.213.76:30695
212.19.20.215:3128
178.130.99.87:8080
124.158.167.242:8080
101.109.56.197:8080
134.35.203.26:8080
41.50.137.181:8080
46.151.145.4:53281
98.213.58.68:80
181.225.106.147:999
36.89.127.115:8080
185.238.239.92:8090
178.63.183.142:1080
81.88.220.110:3128
54.38.155.89:6582
54.38.218.208:6582
52.157.97.234:80
144.76.214.156:1080
144.76.214.157:1080
185.134.23.198:80
82.200.233.4:3128
103.15.167.36:41787
177.46.148.142:3128
54.169.233.132:8888
103.240.160.21:6666
183.182.101.32:30531
138.68.60.8:8080
147.78.160.2:8080
52.149.152.236:80
88.99.10.252:1080
41.217.219.53:31398
178.128.199.55:80
178.252.166.210:8080
144.217.101.245:3129
182.160.99.251:8080
202.57.2.19:8080
190.216.125.74:999
200.115.56.137:80
167.71.212.154:80
103.36.100.248:8000
58.82.154.3:8080
190.83.61.1:999
41.79.194.202:8080
181.143.123.118:8080
45.236.104.178:999
160.16.67.68:8080
41.86.251.62:8080
54.38.218.213:6582
188.165.16.230:3129
200.54.42.3:8080
103.240.161.101:6666
78.47.130.42:8080
74.126.83.200:80
103.105.77.19:8080
162.144.101.185:3838
162.144.106.245:3838
51.255.103.170:3129
43.224.8.116:6666
176.119.134.38:23500
103.141.108.161:3127
103.122.104.114:55168
118.140.151.98:3128
195.9.188.78:53281
45.64.179.77:53281
46.225.241.66:3128
188.235.8.5:51729
188.163.170.130:41209
45.64.179.83:23500
162.144.105.45:3838
195.158.30.146:3128
167.172.191.249:45902
89.20.135.204:80
103.123.64.19:8888
85.10.219.103:1080
93.185.96.60:41003
159.224.182.206:51578
37.57.15.43:33761
194.44.172.254:23500
103.76.18.146:7878
138.117.85.113:999
103.104.183.131:8080
103.233.158.34:8888
118.174.46.144:45330
117.252.216.224:23500
46.99.255.235:8080
105.27.237.27:80
139.99.105.5:80
54.169.246.77:8888
154.127.161.28:8080
81.12.76.9:8080
93.114.119.101:8080
111.68.26.237:8080
105.213.108.80:8080
94.180.129.145:8080
162.252.144.229:8181
170.177.253.32:8080
151.240.250.2:8080
81.12.76.152:8080
46.239.40.189:8080
88.112.115.181:8888
217.219.31.210:38073
195.244.3.246:3128
181.214.88.179:3128
101.109.38.42:8080
150.238.24.68:3128
119.15.95.198:8080
8.129.1.86:8080
89.145.155.38:8080
110.37.216.118:8080
78.47.158.111:3128
195.140.226.244:8080
103.78.141.27:8080
190.61.46.29:999
189.109.219.116:8080
159.192.104.53:8080
81.91.137.42:8080
203.150.113.46:8080
177.43.217.74:8080
41.87.73.50:8080
5.58.88.175:8080
159.203.82.173:3128`
let l =proxiesStr.split("\n").map(v => 
    ({host: v.split(":")[0], port: v.split(":")[1]}))
console.log(l)
}